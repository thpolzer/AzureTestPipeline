{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"factoryName": {
			"type": "string",
			"metadata": "Data Factory name",
			"defaultValue": "datafactorythp"
		}
	},
	"variables": {
		"factoryId": "[concat('Microsoft.DataFactory/factories/', parameters('factoryName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('factoryName'), '/GCS_test')]",
			"type": "Microsoft.DataFactory/factories/pipelines",
			"apiVersion": "2018-06-01",
			"properties": {
				"activities": [
					{
						"name": "Copy data1",
						"type": "Copy",
						"dependsOn": [],
						"policy": {
							"timeout": "7.00:00:00",
							"retry": 0,
							"retryIntervalInSeconds": 30,
							"secureOutput": false,
							"secureInput": false
						},
						"userProperties": [],
						"typeProperties": {
							"source": {
								"type": "JsonSource",
								"storeSettings": {
									"type": "GoogleCloudStorageReadSettings",
									"recursive": true,
									"wildcardFileName": "*12.json",
									"enablePartitionDiscovery": false
								},
								"formatSettings": {
									"type": "JsonReadSettings"
								}
							},
							"sink": {
								"type": "ParquetSink",
								"storeSettings": {
									"type": "AzureBlobStorageWriteSettings",
									"copyBehavior": "MergeFiles"
								},
								"formatSettings": {
									"type": "ParquetWriteSettings"
								}
							},
							"enableStaging": false
						},
						"inputs": [
							{
								"referenceName": "DS_GCS_json",
								"type": "DatasetReference"
							}
						],
						"outputs": [
							{
								"referenceName": "DS_BlobStorage",
								"type": "DatasetReference",
								"parameters": {
									"FileName": "azurefile.json"
								}
							}
						]
					}
				],
				"annotations": []
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/datasets/DS_GCS_json')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/DS_GCS_json')]",
			"type": "Microsoft.DataFactory/factories/datasets",
			"apiVersion": "2018-06-01",
			"properties": {
				"linkedServiceName": {
					"referenceName": "LS_GoogleCloudStorage_adac",
					"type": "LinkedServiceReference"
				},
				"annotations": [],
				"type": "Json",
				"typeProperties": {
					"location": {
						"type": "GoogleCloudStorageLocation",
						"bucketName": "cdh-marketingdata",
						"fileName": "testdata_subset_12.json"
					}
				},
				"schema": {
					"type": "object",
					"properties": {
						"visitNumber": {
							"type": "string"
						},
						"visitId": {
							"type": "string"
						},
						"visitStartTime": {
							"type": "string"
						},
						"date": {
							"type": "string"
						},
						"totals": {
							"type": "object",
							"properties": {
								"visits": {
									"type": "string"
								},
								"hits": {
									"type": "string"
								},
								"pageviews": {
									"type": "string"
								},
								"bounces": {
									"type": "string"
								},
								"newVisits": {
									"type": "string"
								},
								"sessionQualityDim": {
									"type": "string"
								}
							}
						},
						"trafficSource": {
							"type": "object",
							"properties": {
								"campaign": {
									"type": "string"
								},
								"source": {
									"type": "string"
								},
								"medium": {
									"type": "string"
								},
								"adwordsClickInfo": {
									"type": "object",
									"properties": {
										"criteriaParameters": {
											"type": "string"
										}
									}
								},
								"isTrueDirect": {
									"type": "boolean"
								},
								"referralPath": {
									"type": "string"
								}
							}
						},
						"device": {
							"type": "object",
							"properties": {
								"browser": {
									"type": "string"
								},
								"browserVersion": {
									"type": "string"
								},
								"browserSize": {
									"type": "string"
								},
								"operatingSystem": {
									"type": "string"
								},
								"operatingSystemVersion": {
									"type": "string"
								},
								"isMobile": {
									"type": "boolean"
								},
								"mobileDeviceBranding": {
									"type": "string"
								},
								"mobileDeviceModel": {
									"type": "string"
								},
								"mobileInputSelector": {
									"type": "string"
								},
								"mobileDeviceInfo": {
									"type": "string"
								},
								"mobileDeviceMarketingName": {
									"type": "string"
								},
								"flashVersion": {
									"type": "string"
								},
								"language": {
									"type": "string"
								},
								"screenColors": {
									"type": "string"
								},
								"screenResolution": {
									"type": "string"
								},
								"deviceCategory": {
									"type": "string"
								}
							}
						},
						"geoNetwork": {
							"type": "object",
							"properties": {
								"continent": {
									"type": "string"
								},
								"subContinent": {
									"type": "string"
								},
								"country": {
									"type": "string"
								},
								"region": {
									"type": "string"
								},
								"metro": {
									"type": "string"
								},
								"city": {
									"type": "string"
								},
								"cityId": {
									"type": "string"
								},
								"networkDomain": {
									"type": "string"
								},
								"latitude": {
									"type": "string"
								},
								"longitude": {
									"type": "string"
								},
								"networkLocation": {
									"type": "string"
								}
							}
						},
						"customDimensions": {
							"type": "array"
						},
						"hits": {
							"type": "array",
							"items": {
								"type": "object",
								"properties": {
									"hitNumber": {
										"type": "string"
									},
									"time": {
										"type": "string"
									},
									"hour": {
										"type": "string"
									},
									"minute": {
										"type": "string"
									},
									"isInteraction": {
										"type": "boolean"
									},
									"isEntrance": {
										"type": "boolean"
									},
									"isExit": {
										"type": "boolean"
									},
									"referer": {
										"type": "string"
									},
									"page": {
										"type": "object",
										"properties": {
											"pagePath": {
												"type": "string"
											},
											"hostname": {
												"type": "string"
											},
											"pageTitle": {
												"type": "string"
											},
											"pagePathLevel1": {
												"type": "string"
											},
											"pagePathLevel2": {
												"type": "string"
											},
											"pagePathLevel3": {
												"type": "string"
											},
											"pagePathLevel4": {
												"type": "string"
											}
										}
									},
									"transaction": {
										"type": "object",
										"properties": {
											"currencyCode": {
												"type": "string"
											}
										}
									},
									"item": {
										"type": "object",
										"properties": {
											"currencyCode": {
												"type": "string"
											}
										}
									},
									"appInfo": {
										"type": "object",
										"properties": {
											"screenName": {
												"type": "string"
											},
											"landingScreenName": {
												"type": "string"
											},
											"exitScreenName": {
												"type": "string"
											},
											"screenDepth": {
												"type": "string"
											}
										}
									},
									"exceptionInfo": {
										"type": "object",
										"properties": {
											"isFatal": {
												"type": "boolean"
											}
										}
									},
									"product": {
										"type": "array",
										"items": {
											"type": "object",
											"properties": {
												"productSKU": {
													"type": "string"
												},
												"v2ProductName": {
													"type": "string"
												},
												"v2ProductCategory": {
													"type": "string"
												},
												"productVariant": {
													"type": "string"
												},
												"productBrand": {
													"type": "string"
												},
												"productPrice": {
													"type": "string"
												},
												"localProductPrice": {
													"type": "string"
												},
												"isImpression": {
													"type": "boolean"
												},
												"customDimensions": {
													"type": "array"
												},
												"customMetrics": {
													"type": "array"
												},
												"productListName": {
													"type": "string"
												},
												"productListPosition": {
													"type": "string"
												}
											}
										}
									},
									"promotion": {
										"type": "array"
									},
									"eCommerceAction": {
										"type": "object",
										"properties": {
											"action_type": {
												"type": "string"
											},
											"step": {
												"type": "string"
											}
										}
									},
									"experiment": {
										"type": "array"
									},
									"customVariables": {
										"type": "array"
									},
									"customDimensions": {
										"type": "array"
									},
									"customMetrics": {
										"type": "array"
									},
									"type": {
										"type": "string"
									},
									"social": {
										"type": "object",
										"properties": {
											"socialNetwork": {
												"type": "string"
											},
											"hasSocialSourceReferral": {
												"type": "string"
											},
											"socialInteractionNetworkAction": {
												"type": "string"
											}
										}
									},
									"contentGroup": {
										"type": "object",
										"properties": {
											"contentGroup1": {
												"type": "string"
											},
											"contentGroup2": {
												"type": "string"
											},
											"contentGroup3": {
												"type": "string"
											},
											"contentGroup4": {
												"type": "string"
											},
											"contentGroup5": {
												"type": "string"
											},
											"previousContentGroup1": {
												"type": "string"
											},
											"previousContentGroup2": {
												"type": "string"
											},
											"previousContentGroup3": {
												"type": "string"
											},
											"previousContentGroup4": {
												"type": "string"
											},
											"previousContentGroup5": {
												"type": "string"
											},
											"contentGroupUniqueViews2": {
												"type": "string"
											}
										}
									},
									"dataSource": {
										"type": "string"
									},
									"publisher_infos": {
										"type": "array"
									}
								}
							}
						},
						"fullVisitorId": {
							"type": "string"
						},
						"channelGrouping": {
							"type": "string"
						},
						"socialEngagementType": {
							"type": "string"
						}
					}
				}
			},
			"dependsOn": [
				"[concat(variables('factoryId'), '/linkedServices/LS_GoogleCloudStorage_adac')]"
			]
		},
		{
			"name": "[concat(parameters('factoryName'), '/LS_GoogleCloudStorage_adac')]",
			"type": "Microsoft.DataFactory/factories/linkedServices",
			"apiVersion": "2018-06-01",
			"properties": {
				"description": "This Linked Service connects to the GCS storage holding Google Analytics data.",
				"annotations": [],
				"type": "GoogleCloudStorage",
				"typeProperties": {
					"serviceUrl": "https://storage.googleapis.com",
					"accessKeyId": "GOOGFSYANZO4GMOI2TGGMC4V",
					"secretAccessKey": {
						"type": "SecureString",
						"value": "**********"
					}
				}
			},
			"dependsOn": []
		}
	]
}